<!--
 ~ Copyright (c) 2015, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.
 ~
 ~ WSO2 Inc. licenses this file to you under the Apache License,
 ~ Version 2.0 (the "License"); you may not use this file except
 ~ in compliance with the License.
 ~ You may obtain a copy of the License at
 ~
 ~    http://www.apache.org/licenses/LICENSE-2.0
 ~
 ~ Unless required by applicable law or agreed to in writing,
 ~ software distributed under the License is distributed on an
 ~ "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 ~ KIND, either express or implied.  See the License for the
 ~ specific language governing permissions and limitations
 ~ under the License.
 -->
<div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #008000; font-weight: bold">&lt;%@</span> page import<span style="color: #666666">=</span><span style="color: #BA2121">&quot;org.wso2.carbon.context.CarbonContext&quot;</span> <span style="color: #008000; font-weight: bold">%&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;%@</span> page import<span style="color: #666666">=</span><span style="color: #BA2121">&quot;org.wso2.carbon.user.api.UserRealm&quot;</span> <span style="color: #008000; font-weight: bold">%&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;%@</span> page import<span style="color: #666666">=</span><span style="color: #BA2121">&quot;org.wso2.carbon.user.api.UserStoreException&quot;</span> <span style="color: #008000; font-weight: bold">%&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;%@</span> page import<span style="color: #666666">=</span><span style="color: #BA2121">&quot;java.util.List&quot;</span><span style="color: #008000; font-weight: bold">%&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;%@</span> page import<span style="color: #666666">=</span><span style="color: #BA2121">&quot;java.util.Arrays&quot;</span><span style="color: #008000; font-weight: bold">%&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;%</span>
    String username <span style="color: #666666">=</span> request<span style="color: #666666">.</span><span style="color: #7D9029">getParameter</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;username&quot;</span><span style="color: #666666">);</span>
    String password <span style="color: #666666">=</span> request<span style="color: #666666">.</span><span style="color: #7D9029">getParameter</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;password&quot;</span><span style="color: #666666">);</span>
    String role <span style="color: #666666">=</span> request<span style="color: #666666">.</span><span style="color: #7D9029">getParameter</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;role&quot;</span><span style="color: #666666">);</span>
    <span style="color: #B00040">boolean</span> status <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">false</span><span style="color: #666666">;</span>

    <span style="color: #008000; font-weight: bold">try</span> <span style="color: #666666">{</span>
        CarbonContext context <span style="color: #666666">=</span> CarbonContext<span style="color: #666666">.</span><span style="color: #7D9029">getThreadLocalCarbonContext</span><span style="color: #666666">();</span>
        UserRealm realm <span style="color: #666666">=</span> context<span style="color: #666666">.</span><span style="color: #7D9029">getUserRealm</span><span style="color: #666666">();</span>
        <span style="color: #008000; font-weight: bold">if</span><span style="color: #666666">(</span>role <span style="color: #666666">==</span> <span style="color: #008000; font-weight: bold">null</span><span style="color: #666666">){</span>
            <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>username <span style="color: #666666">!=</span> <span style="color: #008000; font-weight: bold">null</span> <span style="color: #666666">&amp;&amp;</span> username<span style="color: #666666">.</span><span style="color: #7D9029">trim</span><span style="color: #666666">().</span><span style="color: #7D9029">length</span><span style="color: #666666">()</span> <span style="color: #666666">&gt;</span> <span style="color: #666666">0)</span> <span style="color: #666666">{</span>
                status <span style="color: #666666">=</span> realm<span style="color: #666666">.</span><span style="color: #7D9029">getUserStoreManager</span><span style="color: #666666">().</span><span style="color: #7D9029">authenticate</span><span style="color: #666666">(</span>username<span style="color: #666666">,</span> password<span style="color: #666666">);</span>
            <span style="color: #666666">}</span>
        <span style="color: #666666">}</span> <span style="color: #008000; font-weight: bold">else</span> <span style="color: #666666">{</span>
            <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>username <span style="color: #666666">!=</span> <span style="color: #008000; font-weight: bold">null</span> <span style="color: #666666">&amp;&amp;</span> username<span style="color: #666666">.</span><span style="color: #7D9029">trim</span><span style="color: #666666">().</span><span style="color: #7D9029">length</span><span style="color: #666666">()</span> <span style="color: #666666">&gt;</span> <span style="color: #666666">0)</span> <span style="color: #666666">{</span>
                status <span style="color: #666666">=</span> Arrays<span style="color: #666666">.</span><span style="color: #7D9029">asList</span><span style="color: #666666">(</span>realm<span style="color: #666666">.</span><span style="color: #7D9029">getUserStoreManager</span><span style="color: #666666">().</span><span style="color: #7D9029">getRoleListOfUser</span><span style="color: #666666">(</span>username<span style="color: #666666">)).</span><span style="color: #7D9029">contains</span><span style="color: #666666">(</span>role<span style="color: #666666">);</span>
            <span style="color: #666666">}</span>
        <span style="color: #666666">}</span>
    <span style="color: #666666">}</span> <span style="color: #008000; font-weight: bold">catch</span> <span style="color: #666666">(</span>UserStoreException e<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        e<span style="color: #666666">.</span><span style="color: #7D9029">printStackTrace</span><span style="color: #666666">();</span>
    <span style="color: #666666">}</span>

    <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>status<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        session<span style="color: #666666">.</span><span style="color: #7D9029">setAttribute</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;logged-in&quot;</span><span style="color: #666666">,</span> <span style="color: #BA2121">&quot;true&quot;</span><span style="color: #666666">);</span>
        session<span style="color: #666666">.</span><span style="color: #7D9029">setAttribute</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;username&quot;</span><span style="color: #666666">,</span> username<span style="color: #666666">);</span>
        <span style="color: #008000; font-weight: bold">if</span><span style="color: #666666">(</span>role <span style="color: #666666">!=</span> <span style="color: #008000; font-weight: bold">null</span><span style="color: #666666">){</span>
            session<span style="color: #666666">.</span><span style="color: #7D9029">setAttribute</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;logged-in-with-role&quot;</span><span style="color: #666666">,</span> <span style="color: #BA2121">&quot;true&quot;</span><span style="color: #666666">);</span>
        <span style="color: #666666">}</span>
        response<span style="color: #666666">.</span><span style="color: #7D9029">sendRedirect</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;index.jsp&quot;</span><span style="color: #666666">);</span>
    <span style="color: #666666">}</span> <span style="color: #008000; font-weight: bold">else</span> <span style="color: #666666">{</span>
        session<span style="color: #666666">.</span><span style="color: #7D9029">invalidate</span><span style="color: #666666">();</span>
        response<span style="color: #666666">.</span><span style="color: #7D9029">sendRedirect</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;index.jsp?failed=true&quot;</span><span style="color: #666666">);</span>
    <span style="color: #666666">}</span>
<span style="color: #008000; font-weight: bold">%&gt;</span>
</pre></td></tr></table></div>
