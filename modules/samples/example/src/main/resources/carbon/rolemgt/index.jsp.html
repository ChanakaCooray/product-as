<!--
 ~ Copyright (c) 2015, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.
 ~
 ~ WSO2 Inc. licenses this file to you under the Apache License,
 ~ Version 2.0 (the "License"); you may not use this file except
 ~ in compliance with the License.
 ~ You may obtain a copy of the License at
 ~
 ~    http://www.apache.org/licenses/LICENSE-2.0
 ~
 ~ Unless required by applicable law or agreed to in writing,
 ~ software distributed under the License is distributed on an
 ~ "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 ~ KIND, either express or implied.  See the License for the
 ~ specific language governing permissions and limitations
 ~ under the License.
 -->
<div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #008000; font-weight: bold">&lt;%@</span>page import<span style="color: #666666">=</span><span style="color: #BA2121">&quot;org.wso2.carbon.user.api.UserRealm&quot;</span> <span style="color: #008000; font-weight: bold">%&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;%@</span>page import<span style="color: #666666">=</span><span style="color: #BA2121">&quot;org.wso2.carbon.context.CarbonContext&quot;</span> <span style="color: #008000; font-weight: bold">%&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;%@</span>page import<span style="color: #666666">=</span><span style="color: #BA2121">&quot;java.util.List&quot;</span><span style="color: #008000; font-weight: bold">%&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;%@</span>page import<span style="color: #666666">=</span><span style="color: #BA2121">&quot;java.util.Arrays&quot;</span><span style="color: #008000; font-weight: bold">%&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;%@</span>page import<span style="color: #666666">=</span><span style="color: #BA2121">&quot;java.util.ArrayList&quot;</span><span style="color: #008000; font-weight: bold">%&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;%@</span>page import<span style="color: #666666">=</span><span style="color: #BA2121">&quot;org.wso2.carbon.user.api.Permission&quot;</span><span style="color: #008000; font-weight: bold">%&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;html&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;head&gt;&lt;/head&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;body&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;h2&gt;</span>WSO2 Carbon Role Manage Usage Demo<span style="color: #008000; font-weight: bold">&lt;/h2&gt;</span>

<span style="color: #008000; font-weight: bold">&lt;%</span>
    CarbonContext context <span style="color: #666666">=</span> CarbonContext<span style="color: #666666">.</span><span style="color: #7D9029">getThreadLocalCarbonContext</span><span style="color: #666666">();</span>
    UserRealm realm <span style="color: #666666">=</span> context<span style="color: #666666">.</span><span style="color: #7D9029">getUserRealm</span><span style="color: #666666">();</span>
    String username <span style="color: #666666">=</span> request<span style="color: #666666">.</span><span style="color: #7D9029">getParameter</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;username&quot;</span><span style="color: #666666">);</span>

    <span style="color: #008000; font-weight: bold">if</span><span style="color: #666666">(</span>request<span style="color: #666666">.</span><span style="color: #7D9029">getParameter</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;add&quot;</span><span style="color: #666666">)</span> <span style="color: #666666">!=</span> <span style="color: #008000; font-weight: bold">null</span> <span style="color: #666666">||</span> request<span style="color: #666666">.</span><span style="color: #7D9029">getParameter</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;remove&quot;</span><span style="color: #666666">)</span> <span style="color: #666666">!=</span> <span style="color: #008000; font-weight: bold">null</span><span style="color: #666666">){</span>
        String role <span style="color: #666666">=</span> request<span style="color: #666666">.</span><span style="color: #7D9029">getParameter</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;role&quot;</span><span style="color: #666666">);</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>username <span style="color: #666666">!=</span> <span style="color: #008000; font-weight: bold">null</span> <span style="color: #666666">&amp;&amp;</span> username<span style="color: #666666">.</span><span style="color: #7D9029">trim</span><span style="color: #666666">().</span><span style="color: #7D9029">length</span><span style="color: #666666">()</span> <span style="color: #666666">&gt;</span> <span style="color: #666666">0)</span> <span style="color: #666666">{</span>
            <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>realm<span style="color: #666666">.</span><span style="color: #7D9029">getUserStoreManager</span><span style="color: #666666">().</span><span style="color: #7D9029">isExistingUser</span><span style="color: #666666">(</span>username<span style="color: #666666">)</span> <span style="color: #666666">&amp;&amp;</span> realm<span style="color: #666666">.</span><span style="color: #7D9029">getUserStoreManager</span><span style="color: #666666">().</span><span style="color: #7D9029">isExistingRole</span><span style="color: #666666">(</span>role<span style="color: #666666">))</span> <span style="color: #666666">{</span>
                List<span style="color: #666666">&lt;</span>String<span style="color: #666666">&gt;</span> rolesList <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> ArrayList<span style="color: #666666">&lt;</span>String<span style="color: #666666">&gt;(</span>Arrays<span style="color: #666666">.</span><span style="color: #7D9029">asList</span><span style="color: #666666">(</span>realm<span style="color: #666666">.</span><span style="color: #7D9029">getUserStoreManager</span><span style="color: #666666">().</span><span style="color: #7D9029">getRoleListOfUser</span><span style="color: #666666">(</span>username<span style="color: #666666">)));</span>
                <span style="color: #008000; font-weight: bold">if</span><span style="color: #666666">(</span>request<span style="color: #666666">.</span><span style="color: #7D9029">getParameter</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;add&quot;</span><span style="color: #666666">)</span> <span style="color: #666666">!=</span> <span style="color: #008000; font-weight: bold">null</span><span style="color: #666666">){</span>
                    <span style="color: #008000; font-weight: bold">if</span><span style="color: #666666">(!</span>rolesList<span style="color: #666666">.</span><span style="color: #7D9029">contains</span><span style="color: #666666">(</span>role<span style="color: #666666">)){</span>
                        realm<span style="color: #666666">.</span><span style="color: #7D9029">getUserStoreManager</span><span style="color: #666666">().</span><span style="color: #7D9029">updateRoleListOfUser</span><span style="color: #666666">(</span>username<span style="color: #666666">,</span> <span style="color: #008000; font-weight: bold">new</span> String<span style="color: #666666">[]{},</span> <span style="color: #008000; font-weight: bold">new</span> String<span style="color: #666666">[]{</span>role<span style="color: #666666">});</span>
                    <span style="color: #666666">}</span> <span style="color: #008000; font-weight: bold">else</span><span style="color: #666666">{</span>
<span style="color: #008000; font-weight: bold">%&gt;</span> <span style="color: #008000; font-weight: bold">&lt;p&gt;&lt;b&gt;</span>The user <span style="color: #008000; font-weight: bold">&lt;%=</span>username<span style="color: #008000; font-weight: bold">%&gt;</span> already have <span style="color: #008000; font-weight: bold">&lt;%=</span>role<span style="color: #008000; font-weight: bold">%&gt;</span> <span style="color: #008000; font-weight: bold">&lt;/b&gt;&lt;/p&gt;</span> <span style="color: #008000; font-weight: bold">&lt;%</span>
                    <span style="color: #666666">}</span>
                <span style="color: #666666">}</span> <span style="color: #008000; font-weight: bold">else</span> <span style="color: #666666">{</span>
                    <span style="color: #008000; font-weight: bold">if</span><span style="color: #666666">(</span>rolesList<span style="color: #666666">.</span><span style="color: #7D9029">contains</span><span style="color: #666666">(</span>role<span style="color: #666666">)){</span>
                        realm<span style="color: #666666">.</span><span style="color: #7D9029">getUserStoreManager</span><span style="color: #666666">().</span><span style="color: #7D9029">updateRoleListOfUser</span><span style="color: #666666">(</span>username<span style="color: #666666">,</span> <span style="color: #008000; font-weight: bold">new</span> String<span style="color: #666666">[]{</span>role<span style="color: #666666">},</span> <span style="color: #008000; font-weight: bold">new</span> String<span style="color: #666666">[]{});</span>
                    <span style="color: #666666">}</span> <span style="color: #008000; font-weight: bold">else</span> <span style="color: #666666">{</span>
<span style="color: #008000; font-weight: bold">%&gt;</span> <span style="color: #008000; font-weight: bold">&lt;p&gt;&lt;b&gt;</span>The user <span style="color: #008000; font-weight: bold">&lt;%=</span>username<span style="color: #008000; font-weight: bold">%&gt;</span> does not have <span style="color: #008000; font-weight: bold">&lt;%=</span>role<span style="color: #008000; font-weight: bold">%&gt;</span> <span style="color: #008000; font-weight: bold">&lt;/b&gt;&lt;/p&gt;</span> <span style="color: #008000; font-weight: bold">&lt;%</span>
                    <span style="color: #666666">}</span>
                <span style="color: #666666">}</span>
            <span style="color: #666666">}</span> <span style="color: #008000; font-weight: bold">else</span> <span style="color: #666666">{</span>
<span style="color: #008000; font-weight: bold">%&gt;</span> <span style="color: #008000; font-weight: bold">&lt;p&gt;&lt;b&gt;</span>The user <span style="color: #008000; font-weight: bold">&lt;%=</span>username<span style="color: #008000; font-weight: bold">%&gt;</span> or <span style="color: #008000; font-weight: bold">&lt;%=</span>role<span style="color: #008000; font-weight: bold">%&gt;</span> does not exist<span style="color: #008000; font-weight: bold">&lt;/b&gt;&lt;/p&gt;</span> <span style="color: #008000; font-weight: bold">&lt;%</span>
            <span style="color: #666666">}</span>
        <span style="color: #666666">}</span>
    <span style="color: #666666">}</span> <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span><span style="color: #666666">(</span>request<span style="color: #666666">.</span><span style="color: #7D9029">getParameter</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;view&quot;</span><span style="color: #666666">)</span> <span style="color: #666666">!=</span> <span style="color: #008000; font-weight: bold">null</span><span style="color: #666666">){</span>
        String<span style="color: #666666">[]</span> rolesList <span style="color: #666666">=</span> realm<span style="color: #666666">.</span><span style="color: #7D9029">getUserStoreManager</span><span style="color: #666666">().</span><span style="color: #7D9029">getRoleListOfUser</span><span style="color: #666666">(</span>username<span style="color: #666666">);</span>
<span style="color: #008000; font-weight: bold">%&gt;&lt;b&gt;</span>Roles of <span style="color: #008000; font-weight: bold">&lt;%=</span>username<span style="color: #008000; font-weight: bold">%&gt;&lt;/b&gt;&lt;ul&gt;&lt;%</span>
        <span style="color: #008000; font-weight: bold">for</span><span style="color: #666666">(</span>String role <span style="color: #666666">:</span> rolesList<span style="color: #666666">){</span>
<span style="color: #008000; font-weight: bold">%&gt;&lt;li&gt;&lt;%=</span>role<span style="color: #008000; font-weight: bold">%&gt;&lt;/li&gt;&lt;%</span>
        <span style="color: #666666">}</span>
    <span style="color: #666666">}</span>
<span style="color: #008000; font-weight: bold">%&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;/ul&gt;</span>

<span style="color: #008000; font-weight: bold">&lt;h3&gt;</span>Add/Remove Role<span style="color: #008000; font-weight: bold">&lt;/h3&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;p&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;form</span> <span style="color: #7D9029">action=</span><span style="color: #BA2121">&quot;index.jsp&quot;</span> <span style="color: #7D9029">method=</span><span style="color: #BA2121">&quot;POST&quot;</span><span style="color: #008000; font-weight: bold">&gt;</span>
    <span style="color: #008000; font-weight: bold">&lt;table&gt;</span>
        <span style="color: #008000; font-weight: bold">&lt;tr&gt;</span>
            <span style="color: #008000; font-weight: bold">&lt;td&gt;</span>Username<span style="color: #008000; font-weight: bold">&lt;/td&gt;</span>
            <span style="color: #008000; font-weight: bold">&lt;td&gt;&lt;input</span> <span style="color: #7D9029">type=</span><span style="color: #BA2121">&quot;text&quot;</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">&quot;username&quot;</span><span style="color: #008000; font-weight: bold">/&gt;&lt;/td&gt;</span>
        <span style="color: #008000; font-weight: bold">&lt;/tr&gt;</span>
        <span style="color: #008000; font-weight: bold">&lt;tr&gt;</span>
            <span style="color: #008000; font-weight: bold">&lt;td&gt;</span>Role<span style="color: #008000; font-weight: bold">&lt;/td&gt;</span>
            <span style="color: #008000; font-weight: bold">&lt;td&gt;&lt;input</span> <span style="color: #7D9029">type=</span><span style="color: #BA2121">&quot;text&quot;</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">&quot;role&quot;</span><span style="color: #008000; font-weight: bold">/&gt;&lt;/td&gt;</span>
        <span style="color: #008000; font-weight: bold">&lt;/tr&gt;</span>
        <span style="color: #008000; font-weight: bold">&lt;tr&gt;</span>
            <span style="color: #008000; font-weight: bold">&lt;td&gt;</span><span style="color: #999999; font-weight: bold">&amp;nbsp;</span><span style="color: #008000; font-weight: bold">&lt;/td&gt;</span>
            <span style="color: #008000; font-weight: bold">&lt;td&gt;</span>
                <span style="color: #008000; font-weight: bold">&lt;input</span> <span style="color: #7D9029">type=</span><span style="color: #BA2121">&quot;submit&quot;</span> <span style="color: #7D9029">value=</span><span style="color: #BA2121">&quot;Add&quot;</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">&quot;add&quot;</span><span style="color: #008000; font-weight: bold">/&gt;</span>
                <span style="color: #008000; font-weight: bold">&lt;input</span> <span style="color: #7D9029">type=</span><span style="color: #BA2121">&quot;submit&quot;</span> <span style="color: #7D9029">value=</span><span style="color: #BA2121">&quot;Remove&quot;</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">&quot;remove&quot;</span><span style="color: #008000; font-weight: bold">/&gt;</span>
            <span style="color: #008000; font-weight: bold">&lt;/td&gt;</span>
        <span style="color: #008000; font-weight: bold">&lt;/tr&gt;</span>
    <span style="color: #008000; font-weight: bold">&lt;/table&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;/form&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;/p&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;/hr&gt;</span>

<span style="color: #008000; font-weight: bold">&lt;h3&gt;</span>Get User Roles<span style="color: #008000; font-weight: bold">&lt;/h3&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;p&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;form</span> <span style="color: #7D9029">action=</span><span style="color: #BA2121">&quot;index.jsp&quot;</span> <span style="color: #7D9029">method=</span><span style="color: #BA2121">&quot;POST&quot;</span><span style="color: #008000; font-weight: bold">&gt;</span>
    <span style="color: #008000; font-weight: bold">&lt;table&gt;</span>
        <span style="color: #008000; font-weight: bold">&lt;tr&gt;</span>
            <span style="color: #008000; font-weight: bold">&lt;td&gt;</span>Username<span style="color: #008000; font-weight: bold">&lt;/td&gt;</span>
            <span style="color: #008000; font-weight: bold">&lt;td&gt;&lt;input</span> <span style="color: #7D9029">type=</span><span style="color: #BA2121">&quot;text&quot;</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">&quot;username&quot;</span><span style="color: #008000; font-weight: bold">/&gt;&lt;/td&gt;</span>
        <span style="color: #008000; font-weight: bold">&lt;/tr&gt;</span>
        <span style="color: #008000; font-weight: bold">&lt;tr&gt;</span>
            <span style="color: #008000; font-weight: bold">&lt;td&gt;</span><span style="color: #999999; font-weight: bold">&amp;nbsp;</span><span style="color: #008000; font-weight: bold">&lt;/td&gt;</span>
            <span style="color: #008000; font-weight: bold">&lt;td&gt;</span>
                <span style="color: #008000; font-weight: bold">&lt;input</span> <span style="color: #7D9029">type=</span><span style="color: #BA2121">&quot;submit&quot;</span> <span style="color: #7D9029">value=</span><span style="color: #BA2121">&quot;View&quot;</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">&quot;view&quot;</span><span style="color: #008000; font-weight: bold">/&gt;</span>
            <span style="color: #008000; font-weight: bold">&lt;/td&gt;</span>
        <span style="color: #008000; font-weight: bold">&lt;/tr&gt;</span>
    <span style="color: #008000; font-weight: bold">&lt;/table&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;/form&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;/p&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;/hr&gt;</span>


<span style="color: #008000; font-weight: bold">&lt;h3&gt;</span>The Role list<span style="color: #008000; font-weight: bold">&lt;/h3&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;ol&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;%</span>
    String<span style="color: #666666">[]</span> roles <span style="color: #666666">=</span> realm<span style="color: #666666">.</span><span style="color: #7D9029">getUserStoreManager</span><span style="color: #666666">().</span><span style="color: #7D9029">getRoleNames</span><span style="color: #666666">();</span>
    <span style="color: #008000; font-weight: bold">for</span> <span style="color: #666666">(</span>String role <span style="color: #666666">:</span> roles<span style="color: #666666">)</span> <span style="color: #666666">{</span>
<span style="color: #008000; font-weight: bold">%&gt;&lt;li&gt;&lt;%=</span>role<span style="color: #008000; font-weight: bold">%&gt;&lt;/li&gt;&lt;%</span>
    <span style="color: #666666">}</span>
<span style="color: #008000; font-weight: bold">%&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;/ol&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;/body&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;/html&gt;</span>
</pre></td></tr></table></div>
